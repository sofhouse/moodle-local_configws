{"version":3,"file":"autoconfig.min.js","sources":["../src/autoconfig.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport Config from 'core/config';\nimport {get_string as getString} from 'core/str';\n\nexport const init = (formClass) => {\n    let button = document.querySelector('[data-action=\"autoconfig-form\"]');\n    button.addEventListener('click', async (e) => {\n        e.preventDefault();\n        let target = e.currentTarget;\n        renderModal(formClass, false, false,target);\n    });\n};\n\n/**\n * Render the modal form.\n *\n * @param {string} formClass\n * @param {int} user\n * @param {int} webservice\n * @param {object} target\n * @returns {void}\n*/\nasync function renderModal(formClass, user = false, webservice = false, target = false) {\n    const form = new ModalForm({\n        formClass,\n        args: {\n            user: user,\n            webservice: webservice,\n        },\n        modalConfig: {\n            title: getString('autoconfig', 'local_configws'),\n        },\n        saveButtonText: 'Save',\n        returnFocus: target\n    });\n    form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n        const response = e.detail;\n        let redirect = `${Config.wwwroot}/local/configws/autoconfig.php?`;\n        let first = false;\n        for (let key in response) {\n            if (first) {\n                first = false;\n            } else {\n                redirect = redirect + '&';\n            }\n            redirect = redirect + `${key}=${response[key]}`;\n        }\n\n        window.location.assign(redirect);\n    });\n    await form.show();\n\n    let bodymodal = form.modal.getRoot().find('.modal-body')[0];\n\n    // Create a new MutationObserver\n    const observer = new MutationObserver((mutationsList, observer) => {\n        // Check if a select element is added to the body\n        const selectAdded = mutationsList.some((mutation) => {\n            return mutation.addedNodes && Array.from(mutation.addedNodes).some(() => {\n                return document.querySelector('.modal-body select[name=\"user\"]');\n            });\n        });\n        if (selectAdded) {\n            observer.disconnect();\n            // Select the event\n            const select = document.querySelector('.modal-body select[name=\"user\"]');\n            const webservice = document.querySelector('.modal-body select[name=\"webservice\"]');\n            select.addEventListener('change', (e) => {\n                form.modal.destroy();\n                if (e.target.value === '') {\n                    return;\n                }\n                renderModal(formClass, e.target.value, webservice.value);\n            });\n        }\n    });\n\n    // Start observing the body for mutations\n    observer.observe(bodymodal, { childList: true, subtree: true });\n\n    const wsobserver = new MutationObserver((mutationsList, observer) => {\n        // Check if a select element is added to the body\n        const selectAdded = mutationsList.some((mutation) => {\n            return mutation.addedNodes && Array.from(mutation.addedNodes).some(() => {\n                return document.querySelector('.modal-body select[name=\"webservice\"]');\n            });\n        });\n        if (selectAdded) {\n            observer.disconnect();\n            // Select the event\n            const select = document.querySelector('.modal-body select[name=\"webservice\"]');\n            const userid = document.querySelector('.modal-body select[name=\"user\"]').value;\n            select.addEventListener('change', (e) => {\n                if (e.target.value === 'new' || e.target.value === '0') {\n                    return;\n                }\n                form.modal.destroy();\n                renderModal(formClass, userid, e.target.value, target);\n            });\n        }\n    }\n    );\n\n    // Start observing the body for mutations\n    wsobserver.observe(bodymodal, { childList: true, subtree: true });\n}"],"names":["renderModal","formClass","user","webservice","target","form","ModalForm","args","modalConfig","title","saveButtonText","returnFocus","addEventListener","events","FORM_SUBMITTED","e","response","detail","redirect","Config","wwwroot","first","key","window","location","assign","show","bodymodal","modal","getRoot","find","observer","MutationObserver","mutationsList","some","mutation","addedNodes","Array","from","document","querySelector","disconnect","select","destroy","value","observe","childList","subtree","wsobserver","userid","async","preventDefault","currentTarget"],"mappings":"8YAsBeA,YAAYC,eAAWC,6DAAcC,mEAAoBC,qEAC9DC,KAAO,IAAIC,mBAAU,CACvBL,UAAAA,UACAM,KAAM,CACFL,KAAMA,KACNC,WAAYA,YAEhBK,YAAa,CACTC,OAAO,mBAAU,aAAc,mBAEnCC,eAAgB,OAChBC,YAAaP,SAEjBC,KAAKO,iBAAiBP,KAAKQ,OAAOC,gBAAiBC,UACzCC,SAAWD,EAAEE,WACfC,mBAAcC,gBAAOC,2CACrBC,OAAQ,MACP,IAAIC,OAAON,SACRK,MACAA,OAAQ,EAERH,UAAsB,IAE1BA,oBAAyBI,gBAAON,SAASM,MAG7CC,OAAOC,SAASC,OAAOP,mBAErBb,KAAKqB,WAEPC,UAAYtB,KAAKuB,MAAMC,UAAUC,KAAK,eAAe,SAGnDC,SAAW,IAAIC,kBAAiB,CAACC,cAAeF,eAE9BE,cAAcC,MAAMC,UAC7BA,SAASC,YAAcC,MAAMC,KAAKH,SAASC,YAAYF,MAAK,IACxDK,SAASC,cAAc,uCAGrB,CACbT,SAASU,mBAEHC,OAASH,SAASC,cAAc,mCAChCrC,WAAaoC,SAASC,cAAc,yCAC1CE,OAAO9B,iBAAiB,UAAWG,IAC/BV,KAAKuB,MAAMe,UACY,KAAnB5B,EAAEX,OAAOwC,OAGb5C,YAAYC,UAAWc,EAAEX,OAAOwC,MAAOzC,WAAWyC,cAM9Db,SAASc,QAAQlB,UAAW,CAAEmB,WAAW,EAAMC,SAAS,UAElDC,WAAa,IAAIhB,kBAAiB,CAACC,cAAeF,eAEhCE,cAAcC,MAAMC,UAC7BA,SAASC,YAAcC,MAAMC,KAAKH,SAASC,YAAYF,MAAK,IACxDK,SAASC,cAAc,6CAGrB,CACbT,SAASU,mBAEHC,OAASH,SAASC,cAAc,yCAChCS,OAASV,SAASC,cAAc,mCAAmCI,MACzEF,OAAO9B,iBAAiB,UAAWG,IACR,QAAnBA,EAAEX,OAAOwC,OAAsC,MAAnB7B,EAAEX,OAAOwC,QAGzCvC,KAAKuB,MAAMe,UACX3C,YAAYC,UAAWgD,OAAQlC,EAAEX,OAAOwC,MAAOxC,gBAO3D4C,WAAWH,QAAQlB,UAAW,CAAEmB,WAAW,EAAMC,SAAS,kBApGzC9C,YACJsC,SAASC,cAAc,mCAC7B5B,iBAAiB,SAASsC,MAAAA,IAC7BnC,EAAEoC,qBACE/C,OAASW,EAAEqC,cACfpD,YAAYC,WAAW,GAAO,EAAMG"}