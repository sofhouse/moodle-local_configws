define("local_configws/autoconfig",["exports","core_form/modalform","core/config","core/str"],(function(_exports,_modalform,_config,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_config=_interopRequireDefault(_config);async function renderModal(formClass){let user=arguments.length>1&&void 0!==arguments[1]&&arguments[1],webservice=arguments.length>2&&void 0!==arguments[2]&&arguments[2],target=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const form=new _modalform.default({formClass:formClass,args:{user:user,webservice:webservice},modalConfig:{title:(0,_str.get_string)("autoconfig","local_configws")},saveButtonText:"Save",returnFocus:target});form.addEventListener(form.events.FORM_SUBMITTED,(e=>{const response=e.detail;let redirect="".concat(_config.default.wwwroot,"/local/configws/autoconfig.php?"),first=!1;for(let key in response)first?first=!1:redirect+="&",redirect+="".concat(key,"=").concat(response[key]);window.location.assign(redirect)})),await form.show();let bodymodal=form.modal.getRoot().find(".modal-body")[0];const observer=new MutationObserver(((mutationsList,observer)=>{if(mutationsList.some((mutation=>mutation.addedNodes&&Array.from(mutation.addedNodes).some((()=>document.querySelector('.modal-body select[name="user"]')))))){observer.disconnect();const select=document.querySelector('.modal-body select[name="user"]'),webservice=document.querySelector('.modal-body select[name="webservice"]');select.addEventListener("change",(e=>{form.modal.destroy(),""!==e.target.value&&renderModal(formClass,e.target.value,webservice.value)}))}}));observer.observe(bodymodal,{childList:!0,subtree:!0});const wsobserver=new MutationObserver(((mutationsList,observer)=>{if(mutationsList.some((mutation=>mutation.addedNodes&&Array.from(mutation.addedNodes).some((()=>document.querySelector('.modal-body select[name="webservice"]')))))){observer.disconnect(),document.querySelector('.modal-body button[name="jsonsave"]').addEventListener("click",(()=>{let downloadlink="/pluginfile.php/10/local_configws/download/"+webservice+"/?userid="+user;window.location.assign(downloadlink)}));const select=document.querySelector('.modal-body select[name="webservice"]'),userid=document.querySelector('.modal-body select[name="user"]').value;select.addEventListener("change",(e=>{"new"!==e.target.value&&"0"!==e.target.value&&(form.modal.destroy(),renderModal(formClass,userid,e.target.value,target))}))}}));wsobserver.observe(bodymodal,{childList:!0,subtree:!0})}_exports.init=formClass=>{document.querySelector('[data-action="autoconfig-form"]').addEventListener("click",(async e=>{e.preventDefault();let target=e.currentTarget;renderModal(formClass,!1,!1,target)}))}}));

//# sourceMappingURL=autoconfig.min.js.map